---
title: PN 筛学习笔记
date: 2024-06-11 20:31:02
categories: 学习笔记
tags:
	- 数论
	- 筛法
---

# PN 筛学习笔记

前情提要：有狗狗（迫真）模拟赛里放这个东西的板子（？）题，这下只能被迫学习了。

## Powerful Number

定义一个数是 Powerful Number，当且仅当其的所有质因子次幂都至少为二，简称 PN。

光是这个不够，还有一个关键结论：所有 PN 都可以写成 $a^2b^3$ 的形式。

这是简单的，考虑对于任意一个不小于等于二的数都可以写成 $2x+3y$ 的形式，然后配一起就可以了。

有这个可以证明什么？

考虑粗略估计 $n$ 以内所有 PN 的数量，也就是：
$$\sum_{i=2}^{\sqrt{n}} \big\lfloor \sqrt[3]{\frac{n}{i^2}}\big\rfloor$$

把求和符号换成积分可以得到数量级是 $\mathcal{O}(\sqrt{n})$ 的。

（说实话我也不清楚这里常数有多少，感觉这实在有点太粗略了，但是下界又刚好是 $\sqrt{n}$ 的，很奇妙）

这样可以通过线筛处理 $\sqrt{n}$ 内的质数，然后爆搜质因数指数得到 $n$ 以内所有 PN，复杂度是 $\mathcal{O}(\sqrt{n})$。

这得到了什么？

如果我们有一个积性函数 $f$，满足 $\forall p\in \mathbb{P},f(p)=0$，则 $f$ 只在 PN 处有值，那么我们就可以爆搜在 $\mathcal{O}(\sqrt{n})$ 的复杂度内得到 $n$ 以内 $f$ 函数的所有点值。

## Powerful Number 筛

求积性函数 $f$ 的前缀和。

我们构造一个积性函数 $f'$，只需要满足 $\forall p\in \mathbb{P},f'(p)=f(p)$，剩下的点值是任意的。

然后找出一个积性函数 $g$，满足 $f'*g=f$。

注意到对于 $\forall{p}\in \mathbb P$，我们有 $f(p)=f'(p)g(1)+f'(1)g(p)$，且 $f(p)=f'(p)=f'(p)g(1),f'(1)=1$，这可以解出 $g(p)=0$，这个结论可以导出 $g$ 只在 PN 有值。

然后剩下就是简单的了：

$$\sum_{i=1}^{n}f(i)=\sum_{xy\leq n}g(x)f'(y)$$

枚举所有 PN 位置的 $x$，现在只要算 $f'$ 在 $\bigg\lfloor\dfrac{n}{x}\bigg\rfloor$ 处的前缀和。

如果 $f'$ 是简单的（例如 $\mathrm{id}$）这种可以 $\mathcal{O}(1)$ 计算的话，那么总复杂度是 $\mathcal{O}(\sqrt{n})$。

否则可能需要对 $f'$ 用杜教筛（其实这里 $f'$ 的限制非常宽，可以构造出完全积性函数，所以应该也很容易构造出杜教筛函数，但是真的吗），由于询问的 $f'$ 前缀和位置，恰好是杜教筛 $f'(n)$ 前缀和时所有第一层会枚举到的位置，因此这里的复杂度等于杜教筛复杂度，简单的情况下总复杂度为 $\mathcal{O}(n^{\frac{2}{3}})$。

还没完，这里 $g$ 怎么算？

如果能够直接蒙出定义式是最好的，否则考虑利用 $f(p^k)=\sum_{i=0}^kf'(p^i)g(p^{k-i})$ 来递推，将 $k$ 从小到大枚举算出答案。

## 例题



